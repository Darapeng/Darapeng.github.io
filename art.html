<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<title>作品分享互動網頁</title>
<link rel="icon" href="palette.png" type="image/png">

<style>
body {
    font-family: Arial, sans-serif;
    background-color: #CFEFFF;
    padding: 20px;
}
.container {
    width: 75%;
    margin: auto;
    background: white;
    padding: 20px;
    border-radius: 10px;
}
.top-bar {
    display: flex;
    justify-content: flex-end;
    gap: 10px;
}
button {
    padding: 6px 12px;
    border-radius: 6px;
    border: none;
    cursor: pointer;
}
.upload { background:#4CAF50;color:white; }
.delete { background:#f44336;color:white; }

.preview {
    width: 100%;
    height: 300px;
    border: 2px dashed #aaa;
    margin: 10px 0;
    object-fit: contain;
}

.list {
    display: flex;
    gap: 6px;
    flex-wrap: wrap;
}
.list img {
    width: 80px;
    height: 80px;
    object-fit: cover;
    cursor: pointer;
    border: 2px solid #ccc;
    border-radius: 6px;
}
.list img.active {
    border-color: #2196F3;
}

.comment {
    background:#eee;
    padding:6px;
    margin-top:5px;
    border-radius:5px;
}
</style>
</head>

<body>

<div class="container">
<h1>作品分享互動網頁</h1>

<div class="top-bar">
    <button class="delete" onclick="deleteWork()">刪除作品</button>
    <button class="upload" onclick="openUploader()">上傳作品</button>
</div>

<input type="file" id="fileInput" accept="image/*" hidden>

<img id="preview" class="preview">

<h3>作品列表</h3>
<div id="list" class="list"></div>

<h3>創作理念</h3>
<textarea id="idea" rows="3" style="width:100%"></textarea>
<button onclick="saveIdea()">儲存理念</button>

<h3>留言區</h3>
<textarea id="comment" rows="2" style="width:100%"></textarea>
<button onclick="addComment()">送出留言</button>
<div id="comments"></div>
</div>

<script>
let works = JSON.parse(localStorage.getItem("works")) || [];
let current = null;
const fileInput = document.getElementById("fileInput");

function openUploader() {
    fileInput.value = ""; // ⭐⭐⭐ 關鍵修正
    fileInput.click();
}

fileInput.addEventListener("change", function () {
    const file = this.files[0];
    if (!file) return;

    const reader = new FileReader();
    reader.onload = () => {
        works.push({ image: reader.result, idea:"", comments:[] });
        save();
        renderList();
        select(works.length - 1);
    };
    reader.readAsDataURL(file);
});

function renderList() {
    list.innerHTML = "";
    works.forEach((w,i)=>{
        const img = document.createElement("img");
        img.src = w.image;
        img.onclick = ()=>select(i);
        if(i===current) img.classList.add("active");
        list.appendChild(img);
    });
}

function select(i){
    current = i;
    preview.src = works[i].image;
    idea.value = works[i].idea;
    showComments();
    renderList();
}

function saveIdea(){
    if(current===null) return;
    works[current].idea = idea.value;
    save();
}

function addComment(){
    if(current===null) return;
    const t = comment.value.trim();
    if(!t) return;
    works[current].comments.push(t);
    comment.value="";
    save();
    showComments();
}

function showComments(){
    comments.innerHTML="";
    works[current].comments.forEach(c=>{
        const d=document.createElement("div");
        d.className="comment";
        d.textContent=c;
        comments.appendChild(d);
    });
}

function deleteWork(){
    if(current===null) return;
    if(!confirm("確定刪除？")) return;
    works.splice(current,1);
    save();
    location.reload();
}

function save(){
    localStorage.setItem("works",JSON.stringify(works));
}

window.onload=()=>{
    renderList();
    if(works.length>0) select(0);
};
</script>

</body>
</html>
