<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<title>作品分享互動網頁</title>
<link rel="icon" href="palette.png" type="image/png">

<style>
body {
    font-family: Arial, sans-serif;
    background-color: #CFEFFF;
    padding: 20px;
}
.container {
    width: 75%;
    margin: auto;
    background: white;
    padding: 20px;
    border-radius: 10px;
}
h1, h2 { text-align: center; }

.top-bar {
    display: flex;
    justify-content: flex-end;
    gap: 10px;
}

button {
    padding: 6px 12px;
    border-radius: 6px;
    border: none;
    cursor: pointer;
}
.upload-btn { background:#4CAF50;color:white; }
.save-btn { background:#2196F3;color:white; }
.delete-btn { background:#f44336;color:white; }

.preview {
    width: 100%;
    height: 300px;
    border: 2px dashed #aaa;
    border-radius: 10px;
    object-fit: contain;
    margin: 10px 0;
}

.work-list {
    display: flex;
    gap: 6px;
    flex-wrap: wrap;
}
.work-list img {
    width: 80px;
    height: 80px;
    object-fit: cover;
    cursor: pointer;
    border-radius: 6px;
    border: 2px solid #ccc;
}
.work-list img.active {
    border-color: #2196F3;
}

textarea { width:100%; padding:8px; }

.comment {
    background:#f1f1f1;
    padding:6px;
    margin-top:5px;
    border-radius:5px;
}
</style>
</head>

<body>

<div class="container">
<h1>作品分享互動網頁</h1>

<div class="top-bar">
    <button class="delete-btn" onclick="deleteWork()">刪除作品</button>
    <button class="upload-btn" onclick="openUploader()">上傳作品</button>
    <button class="save-btn" onclick="saveNewWork()">儲存作品</button>
</div>

<input type="file" id="fileInput" accept="image/*" hidden>

<img id="preview" class="preview">

<h2>作品列表</h2>
<div id="workList" class="work-list"></div>

<hr>

<h2>創作理念</h2>
<textarea id="ideaInput" rows="3" placeholder="請輸入創作理念..."></textarea>

<h2>留言區</h2>
<textarea id="commentInput" rows="2" placeholder="留言（僅已儲存作品）"></textarea>
<button onclick="addComment()">送出留言</button>
<div id="commentList"></div>
</div>

<script>
let works = JSON.parse(localStorage.getItem("works")) || [];
let currentIndex = null;
let tempWork = null;

const fileInput = document.getElementById("fileInput");
const preview = document.getElementById("preview");
const ideaInput = document.getElementById("ideaInput");
const commentInput = document.getElementById("commentInput");
const commentList = document.getElementById("commentList");
const workList = document.getElementById("workList");

window.onload = () => renderList();

// 開啟上傳
function openUploader() {
    fileInput.value = "";
    fileInput.click();
}

// 上傳圖片 → 一定建立 tempWork
fileInput.addEventListener("change", function () {
    const file = this.files[0];
    if (!file) return;

    const reader = new FileReader();
    reader.onload = () => {
        tempWork = {
            image: reader.result,
            idea: "",
            comments: []
        };

        preview.src = tempWork.image;
        ideaInput.value = "";
        commentInput.value = "";
        commentList.innerHTML = "";

        currentIndex = null;
        renderList();
    };
    reader.readAsDataURL(file);
});

// 儲存新作品（只看 tempWork）
function saveNewWork() {
    if (!tempWork) {
        alert("目前沒有可儲存的作品");
        return;
    }

    tempWork.idea = ideaInput.value;
    works.push(tempWork);
    saveData();

    tempWork = null;

    preview.src = "";
    ideaInput.value = "";
    commentInput.value = "";
    commentList.innerHTML = "";

    renderList();
    alert("作品已成功儲存");
}

// 顯示作品列表
function renderList() {
    workList.innerHTML = "";
    works.forEach((work, index) => {
        const img = document.createElement("img");
        img.src = work.image;
        img.onclick = () => selectWork(index);
        if (index === currentIndex) img.classList.add("active");
        workList.appendChild(img);
    });
}

// 選取已儲存作品 → 結束暫存狀態
function selectWork(index) {
    tempWork = null;
    currentIndex = index;

    preview.src = works[index].image;
    ideaInput.value = works[index].idea;
    showComments();
    renderList();
}

// 留言（只限已儲存作品）
function addComment() {
    if (currentIndex === null) {
        alert("請先選擇已儲存的作品");
        return;
    }

    const text = commentInput.value.trim();
    if (!text) return;

    works[currentIndex].comments.push(text);
    commentInput.value = "";
    saveData();
    showComments();
}

// 顯示留言
function showComments() {
    commentList.innerHTML = "";
    works[currentIndex].comments.forEach(c => {
        const div = document.createElement("div");
        div.className = "comment";
        div.textContent = c;
        commentList.appendChild(div);
    });
}

// 刪除作品
function deleteWork() {
    if (currentIndex === null) {
        alert("請先選擇作品");
        return;
    }
    if (!confirm("確定刪除？")) return;

    works.splice(currentIndex, 1);
    saveData();
    location.reload();
}

function saveData() {
    localStorage.setItem("works", JSON.stringify(works));
}
</script>

</body>
</html>
